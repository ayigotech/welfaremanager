<ion-header [translucent]="true">
    <ion-toolbar>
        <ion-buttons slot="start">
            <ion-back-button defaultHref="/home"></ion-back-button>
        </ion-buttons>
        <ion-title>Church Signup</ion-title>
    </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
    <ion-refresher slot="fixed" (ionRefresh)="handleRefresh($event)">
        <ion-refresher-content></ion-refresher-content>
    </ion-refresher>

    <div class="form-container">
        <!-- Step Indicator -->
        <div class="step-indicator">
            <div class="step" [class.active]="currentStep === 1">
                <span class="step-number">1</span>
                <span class="step-label">Church</span>
            </div>
            <div class="step-line"></div>
            <div class="step" [class.active]="currentStep === 2">
                <span class="step-number">2</span>
                <span class="step-label">Admin</span>
            </div>
        </div>

        <form [formGroup]="signupForm" (ngSubmit)="onSubmit()">
            <!-- Step 1: Church Information -->
            <div class="form-step" *ngIf="currentStep === 1">
                <h2>Church Information</h2>

                <!-- Church Name -->
                <div class="input-group">
                    <div class="input-icon">
                        <ion-icon name="business-outline"></ion-icon>
                    </div>
                    <input type="text" class="form-input" placeholder="Church Name" formControlName="church_name" required>
                </div>
                <div class="error-message" *ngIf="showError('church_name')">
                    Church name is required
                </div>

                <!-- Welfare Name -->
                <div class="input-group">
                    <div class="input-icon">
                        <ion-icon name="heart-outline"></ion-icon>
                    </div>
                    <input type="text" class="form-input" placeholder="Welfare Name" formControlName="welfare_name" required>
                </div>
                <div class="error-message" *ngIf="showError('welfare_name')">
                    Welfare name is required
                </div>

                <!-- Location -->
                <div class="input-group">
                    <div class="input-icon">
                        <ion-icon name="location-outline"></ion-icon>
                    </div>
                    <input type="text" class="form-input" placeholder="Church Location" formControlName="location" required>
                </div>
                <div class="error-message" *ngIf="showError('location')">
                    Location is required
                </div>

                <!-- Church Email -->
                <div class="input-group">
                    <div class="input-icon">
                        <ion-icon name="mail-outline"></ion-icon>
                    </div>
                    <input type="email" class="form-input" placeholder="Church Email" formControlName="church_email" required>
                </div>
                <div class="error-message" *ngIf="showError('church_email')">
                    Valid email is required
                </div>


                <!-- Welfare Mobile Money -->
                <div class="input-group">
                    <div class="input-icon">
                        <ion-icon name="phone-portrait-outline"></ion-icon>
                    </div>
                    <input type="tel" class="form-input" placeholder="Welfare Mobile Money Number (e.g., 0551234567)" formControlName="welfare_momo" required>
                </div>
                <div class="error-message" *ngIf="showError('welfare_momo')">
                    Valid mobile money number is required (10 digits starting with 0)
                </div>

                <!-- Church Mobile Money (Optional) -->
                <div class="input-group">
                    <div class="input-icon">
                        <ion-icon name="business-outline"></ion-icon>
                    </div>
                    <input type="tel" class="form-input" placeholder="Church Mobile Money Number (Optional)" formControlName="church_momo">
                </div>
                <div class="error-message" *ngIf="showError('church_momo')">
                    Please enter a valid mobile money number
                </div>


                <button type="button" class="custom-btn btn-primary" (click)="nextStep()" [disabled]="!isStep1Valid() || isLoading">
                  Next
                  <span class="spinner" *ngIf="isLoading"></span>
                </button>
            </div>

            <!-- Step 2: Admin Information -->
            <div class="form-step" *ngIf="currentStep === 2">
                <h2>Admin Information</h2>

                <!-- Full Name -->
                <div class="input-group">
                    <div class="input-icon">
                        <ion-icon name="person-outline"></ion-icon>
                    </div>
                    <input type="text" class="form-input" placeholder="Your Full Name" formControlName="name" required>
                </div>
                <div class="error-message" *ngIf="showError('name')">
                    Full name is required
                </div>

                <!-- Phone Number -->
                <div class="input-group">
                    <div class="input-icon">
                        <ion-icon name="call-outline"></ion-icon>
                    </div>
                    <input type="tel" class="form-input" placeholder="Phone Number" formControlName="phone_number" required>
                </div>
                <div class="error-message" *ngIf="showError('phone_number')">
                    Phone number is required
                </div>


                <!-- Gender -->
                <div class="input-group">
                    <div class="input-icon">
                        <ion-icon name="male-female-outline"></ion-icon>
                    </div>
                    <select class="form-input" formControlName="gender" required>
                        <option value="">Select Gender</option>
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                    </select>
                </div>
                <div class="error-message" *ngIf="signupForm.get('gender')?.invalid && signupForm.get('gender')?.touched">
                    Gender is required
                </div>

                <div class="form-actions">
                    <button type="button" class="btn-secondary" (click)="prevStep()">
            Back
          </button>
                    <button type="submit" class="btn-primary" [disabled]="!isStep2Valid() || isLoading">
            Create Account
            <span class="spinner" *ngIf="isLoading"></span>
          </button>
                </div>
            </div>
        </form>
    </div>
</ion-content>